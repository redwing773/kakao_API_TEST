<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>Kakao API 테스트</h1>
    <div class="karlo_wrap" style="background-color: #eee;">
        <h2>Karlo 카카오 AI 이미지 생성 툴</h2>
        <form action="">
            <div>
                <label for="inp1">프롬프트 입력</label>
                <input type="text" id="inp1" placeholder="영어만 지원">
            </div>
            <div>
                <label for="inp2">제외 단어 입력</label>
                <input type="text" id="inp2" placeholder="선택">
            </div>
            <!-- <button type="submit">제출</button> -->
            <button type="button">제출</button>
        </form>
    </div>

    <div class="kogpt_wrap" style="margin-top:30px;background-color: #eee;">
        <h2>KoGPT 카카오 AI 챗GPT 툴 </h2>
        <form action="">
            <div>
                <label for="inp3">프롬프트 입력</label>
                <input type="text" id="inp3" placeholder="한글만 지원">
            </div>
            <p class="answer"></p>
            <!-- <button type="submit">제출</button> -->
            <button type="button">제출</button>
        </form>
    </div>

    <script>
        // 카카오 공용 api 요청
        async function kakaoAPI(url, data, nocors) {
            try {
                const REST_API_KEY = 'ec4598a1a965774fe72c122f72c1d857';
                let response = await fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `KakaoAK ${REST_API_KEY}`,
                    },
                    // mode: 'no-cors',
                    body: JSON.stringify(data),
                    ...nocors,
                });

                response = response.json(); // JSON 데이터로 응답을 파싱합니다.
                return response;

            } catch (error) {
                console.error('Error:', error);
                throw error;
            }
        };

        // A kitty with black fur
        // sleeping cat, dog, human, ugly face, cropped
        function karloInit() {
            const karlo_url = "https://api.kakaobrain.com/v2/inference/karlo/t2i";
            const karlo_data = {
                prompt: "",
                negative_prompt: "",
                return_type: "base64_string",
                samples: 1,//1 ~ 8개 결과
            }
            
            const tar = document.querySelector('.karlo_wrap');
            if (tar) {
                tar.querySelector('button').addEventListener('click', async () => {
                    karlo_data.prompt = tar.querySelector('#inp1').value == "" ? "fire" : tar.querySelector('#inp1').value;
                    karlo_data.negative_prompt = tar.querySelector('#inp2').value;
                    let response = await kakaoAPI(karlo_url, karlo_data);
                    console.log(response);
                    let arr = [];

                    response.images.forEach(i => {
                        arr.push(i.image)
                    })

                    for (let i = 0; i < arr.length; i++) {
                        let newImg = document.createElement("img");
                        newImg.src = `data:image/;base64,${arr[i]}`;
                        newImg.alt = `${karlo_data.prompt} - ${i}`;
                        document.querySelector('.karlo_wrap').append(newImg);
                    };
                });
            };
        };
        karloInit();

        // 코GPT api
        async function kogptInit() {
            const kogpt_url = "https://api.kakaobrain.com/v1/inference/kogpt/generation";
            const kogpt_data = {
                prompt: "",
                max_tokens: 10, // 결과 토큰 수
                // temperature: 1.0, // 0 ~ 1.0(실수) 높을수록 창의적
                // top_p: 1.0, // 0 ~ 1.0(실수) - 높을수록 창의적
                // n: 1 // 결과 수
            }
            // 일단 얘는 no cors로.. 근데 이거 써도 400에러 ㅠㅜ
            const nocors = {mode: 'no-cors',}
            
            const tar = document.querySelector('.kogpt_wrap');
            if (tar) {
                tar.querySelector('button').addEventListener('click', async () => {
                    kogpt_data.prompt = tar.querySelector('#inp3').value == "" ? "오늘 날씨 어때?" : tar.querySelector('#inp3').value;
                    kogpt_data.max_tokens = 1;
                    // kogpt_data.n = 3;
                    
                    let response = await kakaoAPI(kogpt_url, kogpt_data, nocors);
                    console.log(response);
                    console.log(response.generations[0].text);
                    if(response.generations[0].text){
                        tar.querySelector('.answer').innerHTML = response.generations[0].text;
                    }
                    
                    
                });
            };
        }
        kogptInit();


    </script>
</body>

</html>